"""
These rules will trim sequencing reads and randomly subsample

The inputs are:
    - raw Illumina sequencing reads
The outputs are:
    - cleaned Illumina sequencing reads
    - cleaned sub-sampled Illumina sequencing reads

TODO: currently these don't deal with paired-end data
TODO: insert ifelse statements to process accordingly
"""

rule trimmomatic:
    input:
        "data/{sample}.fastq",
    output:
        "trim/{sample}.fastq"
    params:
        qual = config["trimmomatic_quality"],
        adapters = config["trimmomatic_adapters"],
        minlen = config["trimmomatic_minlen"]
    log:
        "logs/trimmomatic/{sample}.log"
    shell:
        "trimmomatic SE {input} {output} ILLUMINACLIP:{params.adapters}:2:30:10 "
        "LEADING:3 TRAILING:3 SLIDINGWINDOW:4:{params.qual} MINLEN:{params.minlen} 2> {log}"

rule subsample:
    input:
        "trim/{sample}.fastq"
    output:
        "subsampled/{sample}.fastq"
    params:
        nReads = config["subsampled_nReads"]
    log:
        "logs/subsampled/{sample}.log"
    run:
        shell("scripts/sub_sampler.py -1 {input} -o {output} --nReads {params.nReads} > {log}")
